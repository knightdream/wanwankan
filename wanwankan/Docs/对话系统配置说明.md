# æ±ªæ±ªçœ‹ - å¯¹è¯ç³»ç»Ÿé…ç½®è¯´æ˜

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
2. [JSONé…ç½®å­—æ®µè¯´æ˜](#-jsoné…ç½®å­—æ®µè¯´æ˜)
3. [é…ç½®ç¤ºä¾‹](#-é…ç½®ç¤ºä¾‹)
4. [ä½¿ç”¨æ–¹æ³•](#-ä½¿ç”¨æ–¹æ³•)
5. [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºå¯¹è¯UI

åœ¨Unityç¼–è¾‘å™¨ä¸­ï¼š
1. ç‚¹å‡»èœå• **Tools â†’ æ±ªæ±ªçœ‹ â†’ åˆ›å»ºå¯¹è¯ç³»ç»ŸUI**
2. è‡ªåŠ¨åˆ›å»ºå¯¹è¯ç³»ç»Ÿé¢„åˆ¶ä½“å’Œé€‰é¡¹æŒ‰é’®é¢„åˆ¶ä½“
3. é¢„åˆ¶ä½“ä¿å­˜åœ¨ `Assets/Prefabs/Dialogue/` ç›®å½•

### 2. åˆ›å»ºç¤ºä¾‹é…ç½®

1. ç‚¹å‡»èœå• **Tools â†’ æ±ªæ±ªçœ‹ â†’ åˆ›å»ºç¤ºä¾‹å¯¹è¯é…ç½®**
2. ç¤ºä¾‹JSONä¿å­˜åœ¨ `Assets/Resources/Dialogues/sample_dialogue.json`

### 3. æµ‹è¯•å¯¹è¯

1. åœ¨åœºæ™¯ä¸­æ·»åŠ  `DialogueTester` è„šæœ¬åˆ°ä»»æ„ç‰©ä½“
2. è¿è¡Œæ¸¸æˆï¼ŒæŒ‰ **Té”®** å¼€å§‹æµ‹è¯•å¯¹è¯

---

## ğŸ“ JSONé…ç½®å­—æ®µè¯´æ˜

### å¯¹è¯é…ç½® (DialogueConfig)

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `dialogueId` | string | âœ… | å¯¹è¯å”¯ä¸€æ ‡è¯†ç¬¦ |
| `title` | string | âŒ | å¯¹è¯æ ‡é¢˜ï¼ˆç”¨äºç¼–è¾‘å™¨è¯†åˆ«ï¼‰ |
| `defaultTypewriterEffect` | bool | âŒ | å…¨å±€é»˜è®¤ï¼šæ˜¯å¦é€å­—æ˜¾ç¤ºï¼ˆé»˜è®¤trueï¼‰ |
| `defaultTypewriterSpeed` | float | âŒ | å…¨å±€é»˜è®¤ï¼šé€å­—é€Ÿåº¦ï¼ˆé»˜è®¤0.05ç§’/å­—ï¼‰ |
| `defaultCanSkipTypewriter` | bool | âŒ | å…¨å±€é»˜è®¤ï¼šæ˜¯å¦å¯è·³è¿‡é€å­—æ•ˆæœï¼ˆé»˜è®¤trueï¼‰ |
| `backgroundImage` | string | âŒ | èƒŒæ™¯å›¾ç‰‡èµ„æºå |
| `bgmName` | string | âŒ | èƒŒæ™¯éŸ³ä¹èµ„æºå |
| `dialogues` | array | âœ… | å¯¹è¯å†…å®¹åˆ—è¡¨ |
| `onCompleteEvent` | string | âŒ | å¯¹è¯ç»“æŸåè§¦å‘çš„äº‹ä»¶å |

### å•æ¡å¯¹è¯ (DialogueLine)

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|------|--------|
| `id` | int | âœ… | å¯¹è¯IDï¼ˆç”¨äºé€‰é¡¹è·³è½¬ï¼‰ | - |
| `speakerName` | string | âœ… | è¯´è¯è€…åç§° | - |
| `content` | string | âœ… | å¯¹è¯æ–‡å­—å†…å®¹ | - |
| `position` | string | âŒ | è¯´è¯è€…ä½ç½®ï¼š`left` æˆ– `right` | `left` |
| `leftCharacterImage` | string | âŒ | å·¦ä¾§äººç‰©ç«‹ç»˜èµ„æºå | - |
| `rightCharacterImage` | string | âŒ | å³ä¾§äººç‰©ç«‹ç»˜èµ„æºå | - |
| `highlightLeft` | bool | âŒ | æ˜¯å¦é«˜äº®å·¦ä¾§äººç‰© | true |
| `highlightRight` | bool | âŒ | æ˜¯å¦é«˜äº®å³ä¾§äººç‰© | false |
| `typewriterEffect` | bool | âŒ | æ˜¯å¦é€å­—æ˜¾ç¤º | true |
| `typewriterSpeed` | float | âŒ | é€å­—æ˜¾ç¤ºé€Ÿåº¦ï¼ˆç§’/å­—ï¼‰ | 0.05 |
| `canSkipTypewriter` | bool | âŒ | æ˜¯å¦å¯ç‚¹å‡»è·³è¿‡é€å­—æ•ˆæœ | true |
| `autoPlay` | bool | âŒ | æ˜¯å¦è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€å¥ | false |
| `autoPlayDelay` | float | âŒ | è‡ªåŠ¨æ’­æ”¾å»¶è¿Ÿï¼ˆç§’ï¼‰ | 2.0 |
| `triggerEvent` | string | âŒ | å¯¹è¯ç»“æŸåè§¦å‘çš„äº‹ä»¶ | - |
| `choices` | array | âŒ | å¯¹è¯é€‰é¡¹åˆ—è¡¨ï¼ˆåˆ†æ”¯å¯¹è¯ï¼‰ | - |
| `choicesTypewriterEffect` | bool | âŒ | é€‰é¡¹æ˜¯å¦é€å­—æ˜¾ç¤º | false |
| `choicesTypewriterSpeed` | float | âŒ | é€‰é¡¹é€å­—é€Ÿåº¦ï¼ˆç§’/å­—ï¼‰ | 0.03 |
| `choicesAppearSimultaneously` | bool | âŒ | æ‰€æœ‰é€‰é¡¹æ˜¯å¦åŒæ—¶é€å­—å‡ºç° | true |
| `choicesAppearDelay` | float | âŒ | é€‰é¡¹ä¾æ¬¡å‡ºç°çš„é—´éš”ï¼ˆç§’ï¼‰ | 0.3 |
| `choicesShowDelay` | float | âŒ | é€‰é¡¹å‡ºç°å‰çš„å»¶è¿Ÿï¼ˆç§’ï¼‰ | 0.5 |

### å¯¹è¯é€‰é¡¹ (DialogueChoice)

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|------|--------|
| `text` | string | âœ… | é€‰é¡¹æ˜¾ç¤ºæ–‡å­— | - |
| `nextDialogueId` | int | âŒ | é€‰æ‹©åè·³è½¬çš„å¯¹è¯ID | 0ï¼ˆç»§ç»­ä¸‹ä¸€å¥ï¼‰ |
| `triggerEvent` | string | âŒ | é€‰æ‹©åè§¦å‘çš„äº‹ä»¶ | - |
| `moralityChange` | int | âŒ | å–„æ¶å€¼å˜åŒ– | 0 |

---

## ğŸ“„ é…ç½®ç¤ºä¾‹

### åŸºç¡€å¯¹è¯ï¼ˆæ— é€‰é¡¹ï¼‰

```json
{
    "dialogueId": "npc_greeting",
    "title": "NPCé—®å€™",
    "dialogues": [
        {
            "id": 1,
            "speakerName": "æ‘é•¿",
            "content": "ä½ å¥½ï¼Œå¹´è½»çš„å†’é™©è€…ï¼",
            "position": "left",
            "leftCharacterImage": "village_chief",
            "highlightLeft": true,
            "typewriterEffect": true,
            "typewriterSpeed": 0.04
        },
        {
            "id": 2,
            "speakerName": "æ‘é•¿",
            "content": "æ¬¢è¿æ¥åˆ°æ™¨æ›¦é•‡ï¼",
            "position": "left",
            "leftCharacterImage": "village_chief",
            "highlightLeft": true
        }
    ]
}
```

### åˆ†æ”¯å¯¹è¯ï¼ˆæœ‰é€‰é¡¹ï¼‰

```json
{
    "dialogueId": "quest_choice",
    "title": "ä»»åŠ¡é€‰æ‹©",
    "dialogues": [
        {
            "id": 1,
            "speakerName": "çŒäºº",
            "content": "æˆ‘éœ€è¦ä½ å¸®æˆ‘åšä¸€ä»¶äº‹...",
            "position": "left",
            "leftCharacterImage": "hunter",
            "highlightLeft": true
        },
        {
            "id": 2,
            "speakerName": "çŒäºº",
            "content": "ä½ æ„¿æ„å¸®æˆ‘çŒæ€æ£®æ—é‡Œçš„ç™½é¹¿ç‹å—ï¼Ÿ",
            "position": "left",
            "leftCharacterImage": "hunter",
            "highlightLeft": true,
            "choices": [
                {
                    "text": "å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ ",
                    "nextDialogueId": 3,
                    "triggerEvent": "accept_hunt_quest",
                    "moralityChange": -10
                },
                {
                    "text": "ä¸ï¼Œæˆ‘ä¸æƒ³ä¼¤å®³å®ƒ",
                    "nextDialogueId": 4,
                    "triggerEvent": "reject_hunt_quest",
                    "moralityChange": 10
                }
            ]
        },
        {
            "id": 3,
            "speakerName": "çŒäºº",
            "content": "å¤ªå¥½äº†ï¼å»æ£®æ—æ·±å¤„æ‰¾åˆ°å®ƒå§ã€‚",
            "position": "left",
            "leftCharacterImage": "hunter",
            "highlightLeft": true,
            "triggerEvent": "start_hunt_quest"
        },
        {
            "id": 4,
            "speakerName": "çŒäºº",
            "content": "å“¼ï¼ŒçœŸæ˜¯èƒ†å°é¬¼...",
            "position": "left",
            "leftCharacterImage": "hunter",
            "highlightLeft": true
        }
    ]
}
```

### åŒäººå¯¹è¯

```json
{
    "dialogueId": "two_characters",
    "title": "åŒäººå¯¹è¯",
    "dialogues": [
        {
            "id": 1,
            "speakerName": "å®‰æ¯”",
            "content": "ä½ æ˜¯è°ï¼Ÿ",
            "position": "left",
            "leftCharacterImage": "girl_police",
            "rightCharacterImage": "robot_barista",
            "highlightLeft": true,
            "highlightRight": false
        },
        {
            "id": 2,
            "speakerName": "ä¸æ›¼å¤§å¸ˆ",
            "content": "æˆ‘æ˜¯è¿™å®¶å’–å•¡åº—çš„åº—é•¿ã€‚",
            "position": "right",
            "leftCharacterImage": "girl_police",
            "rightCharacterImage": "robot_barista",
            "highlightLeft": false,
            "highlightRight": true
        }
    ]
}
```

### é€‰é¡¹é€å­—æ˜¾ç¤º

```json
{
    "dialogueId": "choices_typewriter",
    "title": "é€‰é¡¹é€å­—æ•ˆæœ",
    "dialogues": [
        {
            "id": 1,
            "speakerName": "NPC",
            "content": "ä½ æƒ³è¦å“ªç§å’–å•¡ï¼Ÿ",
            "choices": [
                { "text": "æ¥ä¸€æ¯ç¾å¼å’–å•¡", "nextDialogueId": 2 },
                { "text": "æˆ‘è¦æ‹¿é“", "nextDialogueId": 3 },
                { "text": "ç®—äº†ï¼Œæˆ‘ä¸å–äº†", "nextDialogueId": 4 }
            ],
            "choicesTypewriterEffect": true,
            "choicesTypewriterSpeed": 0.03,
            "choicesAppearSimultaneously": true,
            "choicesShowDelay": 0.5
        }
    ]
}
```

**é€‰é¡¹æ˜¾ç¤ºæ¨¡å¼å¯¹æ¯”**ï¼š

| é…ç½® | æ•ˆæœ |
|------|------|
| `choicesTypewriterEffect: false` | é€‰é¡¹ç›´æ¥å®Œæ•´æ˜¾ç¤º |
| `choicesTypewriterEffect: true` + `choicesAppearSimultaneously: true` | æ‰€æœ‰é€‰é¡¹åŒæ—¶é€å­—å‡ºç° |
| `choicesTypewriterEffect: true` + `choicesAppearSimultaneously: false` | é€‰é¡¹ä¾æ¬¡é€å­—å‡ºç° |

---

### è‡ªåŠ¨æ’­æ”¾å¯¹è¯

```json
{
    "dialogueId": "auto_play",
    "title": "è‡ªåŠ¨æ’­æ”¾",
    "dialogues": [
        {
            "id": 1,
            "speakerName": "æ—ç™½",
            "content": "æ•…äº‹å¼€å§‹äº†...",
            "typewriterEffect": true,
            "typewriterSpeed": 0.06,
            "autoPlay": true,
            "autoPlayDelay": 1.5
        },
        {
            "id": 2,
            "speakerName": "æ—ç™½",
            "content": "åœ¨ä¸€ä¸ªé¥è¿œçš„ç‹å›½...",
            "typewriterEffect": true,
            "autoPlay": true,
            "autoPlayDelay": 2.0
        }
    ]
}
```

---

## ğŸ® ä½¿ç”¨æ–¹æ³•

### ä»£ç ä¸­è°ƒç”¨å¯¹è¯

```csharp
using Dialogue;

// æ–¹æ³•1ï¼šé€šè¿‡æ–‡ä»¶ååŠ è½½
DialogueManager.Instance.StartDialogue("sample_dialogue");

// æ–¹æ³•2ï¼šé€šè¿‡ä»£ç åˆ›å»º
DialogueConfig config = new DialogueConfig
{
    dialogueId = "my_dialogue",
    dialogues = new List<DialogueLine>
    {
        new DialogueLine
        {
            id = 1,
            speakerName = "NPC",
            content = "ä½ å¥½ï¼"
        }
    }
};
DialogueManager.Instance.StartDialogue(config);
```

### ç›‘å¬å¯¹è¯äº‹ä»¶

```csharp
void Start()
{
    DialogueManager.Instance.OnDialogueStarted += OnDialogueStart;
    DialogueManager.Instance.OnDialogueEnded += OnDialogueEnd;
    DialogueManager.Instance.OnChoiceSelected += OnChoice;
}

void OnDialogueStart(DialogueConfig config)
{
    Debug.Log($"å¯¹è¯å¼€å§‹: {config.title}");
}

void OnDialogueEnd()
{
    Debug.Log("å¯¹è¯ç»“æŸ");
}

void OnChoice(DialogueChoice choice)
{
    Debug.Log($"é€‰æ‹©äº†: {choice.text}ï¼Œå–„æ¶å˜åŒ–: {choice.moralityChange}");
}
```

### äººç‰©ç«‹ç»˜èµ„æº

å°†äººç‰©ç«‹ç»˜å›¾ç‰‡æ”¾åœ¨ `Assets/Resources/Characters/` ç›®å½•ä¸‹ï¼š

```
Assets/
â””â”€â”€ Resources/
    â””â”€â”€ Characters/
        â”œâ”€â”€ girl_police.png      (å·¦ä¾§äººç‰©)
        â”œâ”€â”€ robot_barista.png    (å³ä¾§äººç‰©)
        â””â”€â”€ village_chief.png    (å…¶ä»–äººç‰©)
```

---

## â“ å¸¸è§é—®é¢˜

### Q: å¯¹è¯æ–‡å­—ä¸æ˜¾ç¤ºï¼Ÿ

æ£€æŸ¥ï¼š
1. æ˜¯å¦åˆ›å»ºäº†å¯¹è¯ç³»ç»ŸUIï¼ˆTools â†’ æ±ªæ±ªçœ‹ â†’ åˆ›å»ºå¯¹è¯ç³»ç»ŸUIï¼‰
2. JSONæ–‡ä»¶æ˜¯å¦æ”¾åœ¨ `Assets/Resources/Dialogues/` ç›®å½•
3. JSONæ ¼å¼æ˜¯å¦æ­£ç¡®

### Q: äººç‰©ç«‹ç»˜ä¸æ˜¾ç¤ºï¼Ÿ

æ£€æŸ¥ï¼š
1. å›¾ç‰‡æ˜¯å¦æ”¾åœ¨ `Assets/Resources/Characters/` ç›®å½•
2. `leftCharacterImage` / `rightCharacterImage` å­—æ®µå¡«å†™çš„æ˜¯å¦æ˜¯æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰

### Q: ç‚¹å‡»æ²¡ååº”ï¼Ÿ

æ£€æŸ¥ï¼š
1. åœºæ™¯ä¸­æ˜¯å¦æœ‰ EventSystem
2. DialogueUI çš„ BlockingPanel æ˜¯å¦æ­£ç¡®è®¾ç½®

### Q: å¦‚ä½•æ·»åŠ æ‰“å­—éŸ³æ•ˆï¼Ÿ

1. å°†éŸ³æ•ˆæ–‡ä»¶æ”¾å…¥é¡¹ç›®
2. åœ¨ DialogueUI ç»„ä»¶ä¸­è®¾ç½® `Typing Audio Source` å’Œ `Typing Sound`

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
Assets/
â”œâ”€â”€ Scripts/
â”‚   â””â”€â”€ Dialogue/
â”‚       â”œâ”€â”€ DialogueData.cs      # æ•°æ®ç»“æ„
â”‚       â”œâ”€â”€ DialogueManager.cs   # å¯¹è¯ç®¡ç†å™¨
â”‚       â”œâ”€â”€ DialogueUI.cs        # UIæ§åˆ¶
â”‚       â””â”€â”€ DialogueTester.cs    # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ Resources/
â”‚   â”œâ”€â”€ Dialogues/               # JSONé…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ sample_dialogue.json
â”‚   â””â”€â”€ Characters/              # äººç‰©ç«‹ç»˜
â””â”€â”€ Prefabs/
    â””â”€â”€ Dialogue/
        â”œâ”€â”€ DialogueSystem.prefab
        â””â”€â”€ ChoiceButton.prefab
```

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0*  
*æœ€åæ›´æ–°: 2026-01-16*

