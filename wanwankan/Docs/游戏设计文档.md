# 汪汪看 - 游戏设计文档 (GDD)

## 🎮 游戏概述

**游戏名称**：汪汪看（暂定）  
**类型**：桌游风格 Roguelike RPG  
**平台**：PC (Unity 2D)  
**核心玩法**：骰子检定 + ATB战斗 + 随机地图探索

---

## 🎯 核心游戏循环

```
┌─────────────────────────────────────────────────┐
│                                                 │
│   选择职业 → 进入地下城 → 探索房间 → 战斗/事件  │
│       ↑                                    ↓    │
│       └──── 死亡（解锁新内容）←─── 击败BOSS ────┘
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## ⚔️ 战斗系统详解

### ATB (Active Time Battle) 机制

**核心思想**：不是传统回合制，而是基于"气力值"的实时回合

```
气力条: [████████░░] 80/100

气力恢复公式: 速度 = 10 + 敏捷 × 3
每秒恢复: 速度值 的气力

当气力 >= 100 时:
  → 玩家单位: 暂停，等待玩家选择行动
  → 敌人单位: 自动执行AI行动
  
行动后: 气力归零，重新累积
```

### 战斗流程

```
1. 战斗开始，所有单位气力=0
2. 时间流逝，气力累积
3. 第一个气力满的单位行动
4. 执行行动（攻击/技能/物品/防御）
5. 气力清零，返回步骤2
6. 直到一方全部阵亡
```

### 攻击判定

```
命中检定: 1d20 + 力量修正 vs (10 + 目标敏捷修正)

若命中:
  伤害 = 1d6 + 力量修正
  最低伤害 = 1

特殊:
  投出20 = 大成功，必定命中
  投出1  = 大失败，必定未命中
```

---

## 🗺️ 地图系统 ✅

### 地图结构

```
每层由 5-7 个房间组成:

[起点] ─→ [?] ─→ [?] ─→ [?] ─→ [BOSS]
              ↘       ↗
                [?]

房间之间可能有分支路径
```

### 房间类型

| 图标 | 类型 | 概率 | 内容 |
|-----|------|------|------|
| 🗡️ | 战斗 | 40% | 遭遇敌人，战斗后获得奖励 |
| 💰 | 宝藏 | 15% | 直接获得物品或金币 |
| 🎭 | 事件 | 25% | 随机事件，需要做选择 |
| 🏪 | 商店 | 10% | 购买装备和物品 |
| ⛺ | 休息 | 10% | 恢复HP，可能有代价 |

### 实现状态

**核心系统** ✅
- [x] 房间数据结构（Room类）
- [x] 地图布局管理（MapLayout类）
- [x] 随机地图生成（MapGenerator类）
- [x] 地图管理器（MapManager单例）
- [x] 房间类型枚举（7种类型）
- [x] 房间数据类（战斗/事件/宝藏/商店/休息）

**生成算法**
- [x] 网格布局算法（主路径 + 分支路径）
- [x] 房间类型加权随机分配
- [x] 房间连通性保证（BFS深度计算）
- [x] 分支路径限制（避免跨层连接）

**地图UI** ✅
- [x] 地图面板（可打开/关闭，快捷键M）
- [x] 房间节点可视化（不同状态不同颜色）
- [x] 连接线显示（房间之间的路径）
- [x] 自动刷新（地图生成/房间进入/房间完成时）
- [x] 编辑器工具（一键创建地图UI预制体）

**待实现**
- [ ] 点击房间节点进入房间（导航功能）
- [ ] 房间内容生成（敌人、事件、物品）
- [ ] 与战斗系统集成
- [ ] 与任务系统集成

详见 `Assets/Scripts/Map/` 和 `Assets/Scripts/UI/` 目录

---

## 🎴 道具系统

> 详细设计请参见 `Docs/道具系统.md`

### 道具分类

| 分类 | 图标 | 数量 | 说明 |
|------|------|------|------|
| **材料道具** | 🪨 | 35 | 制作、任务、出售 |
| **武器道具** | ⚔️ | 28 | 攻击力+特殊效果 |
| **装备道具** | 🛡️ | 32 | 防具、饰品、徽章 |
| **药材道具** | 🧪 | 24 | 恢复、增益、治疗 |
| **特殊物品** | ✨ | 26 | 骰子、碎片、钥匙 |

**总计：145个道具**

### 品质等级

| 品质 | 颜色 | 说明 |
|------|------|------|
| 普通 | ⚪ 白色 | 常见物品 |
| 优秀 | 🟢 绿色 | 较好属性 |
| 稀有 | 🔵 蓝色 | 稀有掉落 |
| 史诗 | 🟣 紫色 | BOSS掉落 |
| 传说 | 🟠 橙色 | 极其稀有 |
| 唯一 | 🔴 红色 | 全局仅1个 |

### 关键唯一物品

| 物品 | 获取 | 用途 |
|------|------|------|
| 古老钥匙 | S04 | S30远古宝库 |
| 人贩子徽章 | S03 | S41后续任务 |
| 灵魂碎片×7 | BOSS | 真结局 |
| 命运碎片×5 | 任务 | 命运骰制作 |

---

## 👹 怪物与成长系统

> 详细设计请参见 `Docs/怪物与成长系统.md`

### 角色成长

| 项目 | 数值 | 说明 |
|------|------|------|
| 等级上限 | 40级 | 对应8个章节 |
| 成长点 | +3/级 | 可分配到STR/AGI/WIS |
| 技能点 | +1/5级 | 解锁/升级技能 |

### 属性效果

| 属性 | 每点效果 |
|------|----------|
| STR | HP+2, 物攻+1, 格挡+1% |
| AGI | 速度+3, 闪避+2%, 暴击+1% |
| WIS | 魔攻+1, 魔抗+2%, 技能效果+2% |

### 怪物统计

| 类型 | 数量 | 说明 |
|------|------|------|
| 普通怪 | 39种 | 基础敌人 |
| 精英怪 | 15种 | 属性×1.5 |
| 小BOSS | 7个 | 支线BOSS |
| 守门者 | 7个 | 章节主BOSS |

### 经济平衡

| 项目 | 数值 |
|------|------|
| 任务收入 | ~25,500金币 |
| 打怪收入 | ~25,800金币 |
| 总收入 | ~51,300金币 |
| 预计支出 | ~34,000金币 |

---

## 🎭 事件系统（规划中）

### 事件结构

```
📜 事件标题
   事件描述...
   
   [选项A] → 结果A（需求/风险）
   [选项B] → 结果B（需求/风险）
   [选项C] → 结果C（需求/风险）
```

### 事件示例

```
📜 神秘祭坛

你发现一个古老的祭坛，上面刻着奇怪的符文...

[A] 献祭生命 (消耗3HP)
    → 获得随机祝福
    
[B] 研究符文 (需要WIS>=8)
    → 成功：获得知识，下次事件+2
    → 失败：触发诅咒
    
[C] 无视离开
    → 无事发生
```

---

## 📋 任务系统

> 详细设计请参见 `Docs/任务系统.md`

### 核心设计

任务系统采用**「蛛网式设计」**——任务之间存在复杂的关联、对立和依赖关系。

### 关键机制

| 机制 | 说明 |
|------|------|
| **对立任务** | 完成A任务将永久锁定B任务（如：猎杀白鹿王 vs 保护白鹿王） |
| **分支任务** | 可提前交付获得部分奖励，但会失去后续环节和隐藏内容 |
| **善恶度** | 任务选择影响善恶值（-100~+100），影响结局和可用奖励 |
| **共享物品** | 某些关键物品全局唯一，需谨慎决定用于哪个任务 |
| **任务递减** | 新手村15+任务 → 终章仅1-3个任务 |

### 善恶度影响

```
+100 ~ +50  : 圣者 → 解锁神圣物品、NPC祝福
+49 ~ +20   : 善良 → NPC好感度提升
+19 ~ -19   : 中立 → 平衡路线
-20 ~ -49   : 邪恶 → 解锁暗黑物品
-50 ~ -100  : 堕落者 → 解锁禁忌技能
```

### 任务分布

| 章节 | 区域 | 任务总数 | 可完成数 |
|------|------|----------|----------|
| 第1章 | 晨曦镇 | 15 | 8-10 |
| 第2章 | 贪婪矿洞 | 10 | 6-7 |
| 第3章 | 腐败花园 | 8 | 5-6 |
| 第4章 | 疯狂实验室 | 6 | 4-5 |
| 第5章 | 永恒战场 | 5 | 3-4 |
| 第6章 | 虚空殿堂 | 4 | 2-3 |
| 第7章 | 命运圣所 | 3 | 3 |

**总计**：51个任务，单次游戏可完成约30-35个

### 奖励类型

- 🗡️ **武器**：从【破旧匕首】到【远古武器】
- 🛡️ **防具**：斗篷、护符、徽章等
- 🎲 **骰子**：特殊骰子如【幸运骰】【作弊骰】【命运骰】
- ✨ **技能**：【自然祝福】【恐吓】【亡灵法术】等
- 🏅 **称号**：永久加成如+幸运、+魅力、商店折扣

### 设计意图

1. 玩家无法在单次游戏中完成所有任务
2. 不同路线带来完全不同的体验
3. 关键物品的分配需要战略规划
4. 增加重玩价值和选择的重量感

---

## 👤 职业系统（规划中）

### 初始职业

| 职业 | STR | AGI | WIS | 特殊能力 |
|------|-----|-----|-----|---------|
| 战士 | 3 | 2 | 1 | 战斗第一击+2伤害 |
| 盗贼 | 1 | 3 | 2 | 逃跑100%成功 |
| 法师 | 1 | 2 | 3 | 起始1个法术卷轴 |

### 解锁职业（示例）

| 职业 | 解锁条件 | 特点 |
|------|---------|------|
| 圣骑士 | 通关1次 | 平衡型，有治疗 |
| 游侠 | 击杀100只怪物 | 高AGI，远程攻击 |
| 术士 | 使用50个卷轴 | 高WIS，多法术槽 |

---

## 🔄 Meta进度系统（规划中）

### 传承点数

```
每次游戏结束获得传承点:
- 击杀敌人: +1 点/只
- 通过房间: +5 点/间
- 击败BOSS: +50 点
- 通关: +100 点
```

### 永久解锁

```
🔓 新职业
🔓 新装备（加入奖励池）
🔓 新事件
🔓 起始加成（+HP, +金币等）
```

---

## 🎨 UI/UX 设计

### 战斗界面布局

```
┌─────────────────────────────────────────────────┐
│  [行动顺序预览: 🔵🔴🔵🔴🔵🔴]                    │
│                                                 │
│ ┌───────────┐              ┌───────────┐       │
│ │ 玩家信息  │              │ 敌人信息  │       │
│ │ HP: ██████│   [状态]     │ HP: ████░░│       │
│ │ 气力:█████│              │ 气力:██░░░│       │
│ └───────────┘              └───────────┘       │
│                                                 │
│            ┌─────────────────┐                  │
│            │    战斗场景     │                  │
│            │   (动画区域)    │                  │
│            └─────────────────┘                  │
│                                                 │
│ ┌─────────────────┐                             │
│ │ 战斗日志        │                             │
│ │ > 勇者攻击哥布林│                             │
│ │ > 造成5点伤害   │                             │
│ └─────────────────┘                             │
│                                                 │
│      [攻击] [防御] [技能] [物品]                │
└─────────────────────────────────────────────────┘
```

### 设计原则

1. **清晰的信息层级** - 重要信息突出显示
2. **即时反馈** - 所有操作有明确反馈
3. **骰子可视化** - 让玩家"看到"骰子在滚动
4. **简洁的操作** - 减少不必要的点击

---

## 📈 数值平衡（待调整）

### 玩家成长曲线

```
初始HP: 12-16（取决于STR）
每层预期伤害: HP的30-50%
商店频率: 每2-3个房间
BOSS难度: 约3个普通敌人
```

### 难度参数

```
敌人HP: 8-15（普通）, 30-50（BOSS）
敌人伤害: 2-6
敌人速度: 20-50（普通）, 40-80（精英）
```

---

## 🚀 开发路线图

### Phase 1: 核心战斗 ✅
- [x] 骰子系统
- [x] 属性系统
- [x] ATB战斗
- [x] 基础UI

### Phase 2: 地图探索
- [x] 房间生成 ✅
- [ ] 地图UI
- [x] 房间类型 ✅

### Phase 3: 内容扩展
- [ ] 技能系统
- [ ] 物品系统
- [ ] 事件系统
- [ ] 多职业

### Phase 4: 完善
- [ ] Meta进度
- [ ] 存档系统
- [ ] 音效音乐
- [ ] 打磨平衡

---

*文档版本: 0.2*  
*最后更新: 2024-12-17*

